<?php

if (count($argv) < 2) {
  die("Missing mandatory parameter [version]!\n");
}
$VERSION = $argv[1];

$fields = 'id,collection_i,provider_i,total_f,mandatory_f,descriptiveness_f,searchability_f,contextualization_f,identification_f,browsing_f,viewing_f,reusability_f,multilinguality_f,ProvidedCHO_rdf_about_f,Proxy_rdf_about_f,Proxy_dc_title_f,Proxy_dcterms_alternative_f,Proxy_dc_description_f,Proxy_dc_creator_f,Proxy_dc_publisher_f,Proxy_dc_contributor_f,Proxy_dc_type_f,Proxy_dc_identifier_f,Proxy_dc_language_f,Proxy_dc_coverage_f,Proxy_dcterms_temporal_f,Proxy_dcterms_spatial_f,Proxy_dc_subject_f,Proxy_dc_date_f,Proxy_dcterms_created_f,Proxy_dcterms_issued_f,Proxy_dcterms_extent_f,Proxy_dcterms_medium_f,Proxy_dcterms_provenance_f,Proxy_dcterms_hasPart_f,Proxy_dcterms_isPartOf_f,Proxy_dc_format_f,Proxy_dc_source_f,Proxy_dc_rights_f,Proxy_dc_relation_f,Proxy_edm_isNextInSequence_f,Proxy_edm_type_f,Proxy_edm_europeanaProxy_f,Proxy_edm_year_f,Proxy_edm_userTag_f,Proxy_ore_proxyIn_f,Proxy_ore_proxyFor_f,Proxy_dcterms_conformsTo_f,Proxy_dcterms_hasFormat_f,Proxy_dcterms_hasVersion_f,Proxy_dcterms_isFormatOf_f,Proxy_dcterms_isReferencedBy_f,Proxy_dcterms_isReplacedBy_f,Proxy_dcterms_isRequiredBy_f,Proxy_dcterms_isVersionOf_f,Proxy_dcterms_references_f,Proxy_dcterms_replaces_f,Proxy_dcterms_requires_f,Proxy_dcterms_tableOfContents_f,Proxy_edm_currentLocation_f,Proxy_edm_hasMet_f,Proxy_edm_hasType_f,Proxy_edm_incorporates_f,Proxy_edm_isDerivativeOf_f,Proxy_edm_isRelatedTo_f,Proxy_edm_isRepresentationOf_f,Proxy_edm_isSimilarTo_f,Proxy_edm_isSuccessorOf_f,Proxy_edm_realizes_f,Proxy_edm_wasPresentAt_f,Aggregation_rdf_about_f,Aggregation_edm_rights_f,Aggregation_edm_provider_f,Aggregation_edm_dataProvider_f,Aggregation_edm_isShownAt_f,Aggregation_edm_isShownBy_f,Aggregation_edm_object_f,Aggregation_edm_hasView_f,Aggregation_dc_rights_f,Aggregation_edm_ugc_f,Aggregation_edm_aggregatedCHO_f,Aggregation_edm_intermediateProvider_f,Place_rdf_about_f,Place_wgs84_lat_f,Place_wgs84_long_f,Place_wgs84_alt_f,Place_dcterms_isPartOf_f,Place_wgs84_pos_lat_long_f,Place_dcterms_hasPart_f,Place_owl_sameAs_f,Place_skos_prefLabel_f,Place_skos_altLabel_f,Place_skos_note_f,Agent_rdf_about_f,Agent_edm_begin_f,Agent_edm_end_f,Agent_edm_hasMet_f,Agent_edm_isRelatedTo_f,Agent_owl_sameAs_f,Agent_foaf_name_f,Agent_dc_date_f,Agent_dc_identifier_f,Agent_rdaGr2_dateOfBirth_f,Agent_rdaGr2_placeOfBirth_f,Agent_rdaGr2_dateOfDeath_f,Agent_rdaGr2_placeOfDeath_f,Agent_rdaGr2_dateOfEstablishment_f,Agent_rdaGr2_dateOfTermination_f,Agent_rdaGr2_gender_f,Agent_rdaGr2_professionOrOccupation_f,Agent_rdaGr2_biographicalInformation_f,Agent_skos_prefLabel_f,Agent_skos_altLabel_f,Agent_skos_note_f,Timespan_rdf_about_f,Timespan_edm_begin_f,Timespan_edm_end_f,Timespan_dcterms_isPartOf_f,Timespan_dcterms_hasPart_f,Timespan_edm_isNextInSequence_f,Timespan_owl_sameAs_f,Timespan_skos_prefLabel_f,Timespan_skos_altLabel_f,Timespan_skos_note_f,Concept_rdf_about_f,Concept_skos_broader_f,Concept_skos_narrower_f,Concept_skos_related_f,Concept_skos_broadMatch_f,Concept_skos_narrowMatch_f,Concept_skos_relatedMatch_f,Concept_skos_exactMatch_f,Concept_skos_closeMatch_f,Concept_skos_notation_f,Concept_skos_inScheme_f,Concept_skos_prefLabel_f,Concept_skos_altLabel_f,Concept_skos_note_f,crd_ProvidedCHO_rdf_about_f,crd_Proxy_rdf_about_f,crd_Proxy_dc_title_f,crd_Proxy_dcterms_alternative_f,crd_Proxy_dc_description_f,crd_Proxy_dc_creator_f,crd_Proxy_dc_publisher_f,crd_Proxy_dc_contributor_f,crd_Proxy_dc_type_f,crd_Proxy_dc_identifier_f,crd_Proxy_dc_language_f,crd_Proxy_dc_coverage_f,crd_Proxy_dcterms_temporal_f,crd_Proxy_dcterms_spatial_f,crd_Proxy_dc_subject_f,crd_Proxy_dc_date_f,crd_Proxy_dcterms_created_f,crd_Proxy_dcterms_issued_f,crd_Proxy_dcterms_extent_f,crd_Proxy_dcterms_medium_f,crd_Proxy_dcterms_provenance_f,crd_Proxy_dcterms_hasPart_f,crd_Proxy_dcterms_isPartOf_f,crd_Proxy_dc_format_f,crd_Proxy_dc_source_f,crd_Proxy_dc_rights_f,crd_Proxy_dc_relation_f,crd_Proxy_edm_isNextInSequence_f,crd_Proxy_edm_type_f,crd_Proxy_edm_europeanaProxy_f,crd_Proxy_edm_year_f,crd_Proxy_edm_userTag_f,crd_Proxy_ore_proxyIn_f,crd_Proxy_ore_proxyFor_f,crd_Proxy_dcterms_conformsTo_f,crd_Proxy_dcterms_hasFormat_f,crd_Proxy_dcterms_hasVersion_f,crd_Proxy_dcterms_isFormatOf_f,crd_Proxy_dcterms_isReferencedBy_f,crd_Proxy_dcterms_isReplacedBy_f,crd_Proxy_dcterms_isRequiredBy_f,crd_Proxy_dcterms_isVersionOf_f,crd_Proxy_dcterms_references_f,crd_Proxy_dcterms_replaces_f,crd_Proxy_dcterms_requires_f,crd_Proxy_dcterms_tableOfContents_f,crd_Proxy_edm_currentLocation_f,crd_Proxy_edm_hasMet_f,crd_Proxy_edm_hasType_f,crd_Proxy_edm_incorporates_f,crd_Proxy_edm_isDerivativeOf_f,crd_Proxy_edm_isRelatedTo_f,crd_Proxy_edm_isRepresentationOf_f,crd_Proxy_edm_isSimilarTo_f,crd_Proxy_edm_isSuccessorOf_f,crd_Proxy_edm_realizes_f,crd_Proxy_edm_wasPresentAt_f,crd_Aggregation_rdf_about_f,crd_Aggregation_edm_rights_f,crd_Aggregation_edm_provider_f,crd_Aggregation_edm_dataProvider_f,crd_Aggregation_edm_isShownAt_f,crd_Aggregation_edm_isShownBy_f,crd_Aggregation_edm_object_f,crd_Aggregation_edm_hasView_f,crd_Aggregation_dc_rights_f,crd_Aggregation_edm_ugc_f,crd_Aggregation_edm_aggregatedCHO_f,crd_Aggregation_edm_intermediateProvider_f,crd_Place_rdf_about_f,crd_Place_wgs84_lat_f,crd_Place_wgs84_long_f,crd_Place_wgs84_alt_f,crd_Place_dcterms_isPartOf_f,crd_Place_wgs84_pos_lat_long_f,crd_Place_dcterms_hasPart_f,crd_Place_owl_sameAs_f,crd_Place_skos_prefLabel_f,crd_Place_skos_altLabel_f,crd_Place_skos_note_f,crd_Agent_rdf_about_f,crd_Agent_edm_begin_f,crd_Agent_edm_end_f,crd_Agent_edm_hasMet_f,crd_Agent_edm_isRelatedTo_f,crd_Agent_owl_sameAs_f,crd_Agent_foaf_name_f,crd_Agent_dc_date_f,crd_Agent_dc_identifier_f,crd_Agent_rdaGr2_dateOfBirth_f,crd_Agent_rdaGr2_placeOfBirth_f,crd_Agent_rdaGr2_dateOfDeath_f,crd_Agent_rdaGr2_placeOfDeath_f,crd_Agent_rdaGr2_dateOfEstablishment_f,crd_Agent_rdaGr2_dateOfTermination_f,crd_Agent_rdaGr2_gender_f,crd_Agent_rdaGr2_professionOrOccupation_f,crd_Agent_rdaGr2_biographicalInformation_f,crd_Agent_skos_prefLabel_f,crd_Agent_skos_altLabel_f,crd_Agent_skos_note_f,crd_Timespan_rdf_about_f,crd_Timespan_edm_begin_f,crd_Timespan_edm_end_f,crd_Timespan_dcterms_isPartOf_f,crd_Timespan_dcterms_hasPart_f,crd_Timespan_edm_isNextInSequence_f,crd_Timespan_owl_sameAs_f,crd_Timespan_skos_prefLabel_f,crd_Timespan_skos_altLabel_f,crd_Timespan_skos_note_f,crd_Concept_rdf_about_f,crd_Concept_skos_broader_f,crd_Concept_skos_narrower_f,crd_Concept_skos_related_f,crd_Concept_skos_broadMatch_f,crd_Concept_skos_narrowMatch_f,crd_Concept_skos_relatedMatch_f,crd_Concept_skos_exactMatch_f,crd_Concept_skos_closeMatch_f,crd_Concept_skos_notation_f,crd_Concept_skos_inScheme_f,crd_Concept_skos_prefLabel_f,crd_Concept_skos_altLabel_f,crd_Concept_skos_note_f,long_subject_f_f,same_title_and_description_f_f,empty_string_f';
$dir = '/projects/pkiraly/data-export/' . $VERSION . '/parts-completeness';

if (!file_exists($dir)) {
  die("$dir doesn't exist\n");
}

$files = glob($dir . '/*.csv');
$url = sprintf('http://localhost:8984/solr/qa-%s/update?commit=true&header=false&fieldnames=%s', $VERSION, $fields);
echo $url, "\n";

echo date('H:i:s'), "\n";
$numbers = ['05', '06'];
$numbers_skip = ['00', '02', '09', '21', '26', '31', '46', '52', '57', '58', '59'];
foreach ($files as $i => $file) {
  $process = FALSE;
  foreach ($numbers as $number) {
    if (strstr($file, 'part' . $number . '.csv'))
      $process = TRUE;
  }
  if (!$process)
    continue;

  printf("%s %s (%d/%d)\n", date('H:i:s'), $file, $i+1, count($files));
  $cmd = "curl -s '$url'"
       . " --data-binary @$file"
       . " -H 'Content-type:application/csv'";
  // echo $cmd, "\n";
  exec($cmd);
}
echo date('H:i:s'), "\n";
